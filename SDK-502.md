# SDK-502  
## Operator Reference Implementation Specification  
**Status:** Draft v1.0  
**Category:** Developer Infrastructure  

---

# 1. Purpose

This specification defines the reference behavior for Tetcore Inference Operator Nodes.

It governs:

- Inference request handling
- Model execution standards
- Receipt submission timing
- Streaming response guidelines
- Economic compliance requirements

Operators execute off-chain inference while remaining economically accountable on-chain.

---

# 2. Operator Role Summary

An Inference Operator:

- Listens for SubmitPrompt events
- Retrieves encrypted prompt payload
- Executes model inference
- Produces output
- Submits SubmitReceipt transaction
- Receives revenue via routing engine

Operators are NOT consensus validators (unless dual-role).

---

# 3. Inference Node Behavior

---

## 3.1 Event Monitoring

Operator must monitor:

- New blocks
- SubmitPrompt transactions
- Relevant model_id

Operator must verify:

- Model state == Active
- version matches
- escrow sufficient
- deadline not expired

---

## 3.2 Prompt Retrieval

If relay_mode == 0:

Fetch encrypted payload via relay.

If relay_mode == 1:

Receive direct connection from client.

Operator must:

- Decrypt prompt
- Verify prompt_commitment matches commitment in chain

If mismatch:

Reject execution.

---

## 3.3 Model Loading

Operator must:

- Load correct model version
- Verify shard integrity against shard_root
- Ensure model hash matches commitment

Operators must not execute unverified model weights.

---

## 3.4 Execution Rules

Execution must:

- Respect max_output_tokens
- Respect compute limits
- Avoid modifying input prompt
- Avoid altering inference parameters

Operators must not:

- Inflate token counts artificially
- Generate beyond requested limit

---

# 4. Receipt Timing

---

## 4.1 Deadline Rule

Receipt must be submitted before:

deadline_height

If:

current_height > deadline_height

Operator must NOT submit receipt.

---

## 4.2 Recommended Timing

Operator should submit receipt:

Immediately after inference completion.

Avoid excessive delay to minimize:

Escrow lock duration.

---

## 4.3 Late Receipt Handling

If receipt submitted after deadline:

Transaction will be rejected.

Operator receives no payment.

---

# 5. Receipt Construction

Receipt must include:

- prompt_tx_hash
- output_commitment
- input_tokens
- output_tokens
- compute_units
- operator signature

Operator must ensure:

output_tokens â‰¤ max_output_tokens

All values must be honest and accurate.

---

# 6. Streaming Guidelines

Streaming is allowed but off-chain only.

---

## 6.1 Streaming Model

Operator may stream:

Partial output tokens to client.

However:

Receipt must commit only final output.

---

## 6.2 Finalization Rule

After streaming complete:

Operator computes:

output_commitment = SHA256(final_output || salt)

Receipt must reference final committed output.

Streaming tokens not individually committed on-chain.

---

## 6.3 Streaming Failure

If stream interrupted:

Operator may:

- Resume streaming
- Or abort and not submit receipt

Receipt must not be submitted unless full output delivered.

---

# 7. Compute Accounting

Operator must report:

input_tokens  
output_tokens  
compute_units  

Compute_units must reflect:

Deterministic accounting method.

Governance may define:

Compute-to-token ratio bounds.

---

# 8. Integrity Obligations

Operator must:

- Execute correct model version
- Avoid modifying inference behavior
- Respect pricing model
- Avoid fee manipulation

Malicious behavior may lead to:

- Reputation loss
- Collateral slashing (if enabled)
- Governance blacklisting

---

# 9. Multi-Model Support

Operator may host:

- Multiple models
- Multiple versions
- Multiple pricing modes

Must ensure correct model used per prompt.

---

# 10. Failure Handling

---

## 10.1 Decryption Failure

If encrypted payload invalid:

Abort execution.

---

## 10.2 Model Execution Failure

If model crashes:

Do not submit receipt.

Escrow will refund after expiry.

---

## 10.3 Partial Compute Failure

Operator must not:

Submit receipt for incomplete inference.

---

# 11. Concurrency Model

Operators may process:

Multiple prompts in parallel.

However:

Receipt order must correspond to correct prompt_tx_hash.

No cross-prompt mixing allowed.

---

# 12. Resource Management

Operators should:

- Maintain sufficient GPU/CPU capacity
- Avoid overcommitting
- Monitor compute load

Congestion multiplier may increase fees during overload.

---

# 13. Security Requirements

Operators must:

- Secure private signing key
- Secure model weight storage
- Verify shard integrity
- Avoid leaking plaintext prompts

Operators must not:

Log plaintext prompt to insecure storage.

---

# 14. Key Management

Operator key must:

- Be Ed25519 per TET-003
- Be distinct from validator key (recommended)
- Be protected in secure enclave if possible

---

# 15. Reputation (Optional Extension)

Future versions may support:

- Operator reputation scoring
- Performance metrics
- Uptime tracking
- Quality ratings

Current protocol does not enforce reputation on-chain.

---

# 16. Economic Behavior

Operators maximize revenue by:

- Accurate reporting
- Fast execution
- Competitive pricing
- High reliability

Dishonest reporting risks:

Slashing and blacklisting.

---

# 17. Formal Operator Execution Flow

1. Detect SubmitPrompt  
2. Verify model and escrow  
3. Retrieve encrypted prompt  
4. Decrypt and validate commitment  
5. Execute inference  
6. Stream output (optional)  
7. Compute output_commitment  
8. Construct and sign SubmitReceipt  
9. Broadcast receipt  

---

# 18. Determinism Boundary

Operator behavior must not affect:

- Consensus logic
- Fee computation algorithm
- Escrow limits
- Revenue split formula

Operator is off-chain execution provider.

---

# 19. Upgrade Compatibility

Operator must track:

- Runtime version
- Pricing parameter changes
- Compute cap updates
- Governance decisions affecting models

Failure to adapt may cause receipt rejection.

---

# 20. Conclusion

SDK-502 defines the Operator Reference Implementation as:

- Commitment-validated
- Deadline-aware
- Stream-capable
- Economically accountable
- Deterministically settling

Operators are the computational backbone of Tetcore.

They provide intelligence execution while remaining bound by:

Escrow rules  
Receipt protocol  
Revenue routing  
Governance oversight  

This completes the operator integration layer of the Tetcore ecosystem.

---

End of SDK-502.